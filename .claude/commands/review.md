# 代码审查命令

你是代码审查专家，负责审查代码质量和发现潜在问题。

## 输入

- 文件路径/目录
- 审查范围（可选：全部/安全/性能/规范）

## 审查维度

### 1. 代码质量

- **可读性**：命名清晰、结构合理
- **复杂度**：函数不超过 50 行、嵌套不超过 3 层
- **重复**：避免复制粘贴代码
- **一致性**：遵循项目现有模式

### 2. 类型安全

- 避免 any 类型
- 正确使用泛型
- 接口定义完整
- 空值处理正确

### 3. 错误处理

- try-catch 覆盖异步操作
- 错误信息有意义
- 用户友好的错误提示
- 不吞掉错误

### 4. 安全检查

- 无 SQL 注入风险
- 无 XSS 风险
- 敏感数据不暴露
- 权限检查到位

### 5. 性能考量

- 避免不必要的重渲染
- 大列表使用虚拟滚动
- 图片懒加载
- API 请求合并

## 执行流程

### 1. 收集文件

```
Glob(pattern="src/**/*.tsx")
Glob(pattern="server/src/**/*.ts")
```

### 2. 逐文件审查

对每个文件：

```
Read(file_path="...")
```

检查以上维度，记录问题。

### 3. 输出报告

```markdown
# 代码审查报告

审查时间: YYYY-MM-DD HH:mm
审查范围: [路径]
文件数量: N

## 问题摘要

| 级别 | 数量 |
|------|------|
| 严重 | 0 |
| 警告 | 3 |
| 建议 | 5 |

## 问题详情

### 严重问题

无

### 警告

#### W1: [文件:行号] 未处理的异步错误
```typescript
// 问题代码
async function fetchData() {
  const res = await api.get('/data')  // 缺少 try-catch
}

// 建议修复
async function fetchData() {
  try {
    const res = await api.get('/data')
  } catch (err) {
    console.error('获取数据失败:', err)
    throw err
  }
}
```

### 建议

#### S1: [文件:行号] 可简化的代码
...

## 总体评价

[整体代码质量评价和改进建议]
```

## 问题级别定义

| 级别 | 说明 | 示例 |
|------|------|------|
| 严重 | 必须修复 | 安全漏洞、数据丢失风险 |
| 警告 | 建议修复 | 错误处理缺失、类型问题 |
| 建议 | 可选改进 | 代码风格、性能优化 |

## 自动修复

对于简单问题，可以提供自动修复：

```
Edit(file_path="...", old_string="问题代码", new_string="修复代码")
```

## 审查清单

### 前端代码
- [ ] 组件职责单一
- [ ] Props 类型完整
- [ ] 事件处理正确
- [ ] 样式无硬编码
- [ ] 响应式适配

### 后端代码
- [ ] 输入验证完整
- [ ] 错误处理覆盖
- [ ] 数据库操作安全
- [ ] 日志记录合理
- [ ] 权限检查到位

### 状态管理
- [ ] State 结构合理
- [ ] Actions 命名清晰
- [ ] 避免不必要的状态
- [ ] 派生状态正确

## 退出条件

- 审查报告生成
- 严重问题已标记
- 提供修复建议
